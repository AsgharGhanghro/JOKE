<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Joke - AI Joke Evaluator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Battery Header -->
        <div class="battery-header">
            <div class="battery-info">
                <i class="fas fa-battery-full"></i>
                <div class="battery-text">
                    <span class="battery-label">Battery Health</span>
                    <span class="battery-percent" id="batteryPercent">100%</span>
                </div>
            </div>
            <div class="battery-bar">
                <div class="battery-fill" id="batteryFill"></div>
            </div>
            <div class="battery-status" id="batteryStatus">Ready for jokes!</div>
        </div>

        <!-- Main App -->
        <div class="main-app">
            <!-- Bot Response Area -->
            <div class="bot-response-area">
                <div class="bot-avatar">
                    <div class="bot-icon">ü§ñ</div>
                </div>
                <div class="response-container">
                    <div class="response-text" id="responseText">
                        Hello! Tell me a joke and I'll give you my reaction!
                    </div>
                    <div class="response-controls">
                        <button id="speakBtn" class="speak-btn" disabled>
                            <i class="fas fa-volume-up"></i> Speak Response
                        </button>
                    </div>
                </div>
            </div>

            <!-- Joke Input Area -->
            <div class="input-area">
                <div class="input-header">
                    <h3><i class="fas fa-microphone-alt"></i> Your Joke</h3>
                    <div class="input-tabs">
                        <button class="tab-btn active" id="textTab">
                            <i class="fas fa-keyboard"></i> Text
                        </button>
                        <button class="tab-btn" id="voiceTab">
                            <i class="fas fa-microphone"></i> Voice
                        </button>
                    </div>
                </div>

                <!-- Text Input -->
                <div class="input-section active" id="textSection">
                    <textarea id="jokeInput"
                        placeholder="Why don't scientists trust atoms? Because they make up everything! üòÑ"
                        rows="3"></textarea>
                    <div class="input-footer">
                        <span class="char-count" id="charCount">0 chars</span>
                        <button id="evaluateBtn" class="evaluate-btn">
                            <i class="fas fa-brain"></i> Evaluate Joke
                        </button>
                    </div>
                </div>

                <!-- Voice Input -->
                <div class="input-section" id="voiceSection">
                    <div class="voice-recorder">
                        <div class="voice-display">
                            <div class="mic-icon" id="micIcon">
                                <i class="fas fa-microphone"></i>
                            </div>
                            <div class="voice-bars">
                                <div class="bar"></div>
                                <div class="bar"></div>
                                <div class="bar"></div>
                            </div>
                        </div>
                        <button id="recordBtn" class="record-btn">
                            <i class="fas fa-microphone"></i> Start Recording
                        </button>
                        <div class="voice-status" id="voiceStatus">
                            Press button to record your joke
                        </div>
                    </div>
                    <div class="transcript-box">
                        <div class="transcript-text" id="transcriptText">
                            Your spoken joke will appear here...
                        </div>
                        <button id="useTranscriptBtn" class="use-btn" disabled>
                            Use This Joke
                        </button>
                    </div>
                </div>

                <!-- Example Jokes -->
                <div class="examples-box">
                    <p class="examples-label">Try these examples:</p>
                    <div class="example-buttons">
                        <button class="example-btn"
                            data-joke="Why don't skeletons fight each other? They don't have the guts.">
                            üíÄ Skeleton Joke
                        </button>
                        <button class="example-btn" data-joke="What do you call a fake noodle? An impasta!">
                            üçù Pasta Joke
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- App Footer -->
        <div class="app-footer">
            <div class="footer-left">
                <span class="status">
                    <i class="fas fa-circle status-online"></i> AI Online
                </span>
            </div>
            <div class="footer-right">
                <button id="resetBtn" class="footer-btn">
                    <i class="fas fa-redo"></i> Reset
                </button>
                <button id="helpBtn" class="footer-btn">
                    <i class="fas fa-question-circle"></i> Help
                </button>
            </div>
        </div>
    </div>

    <!-- Audio for speech -->
    <audio id="speechAudio" hidden></audio>

    <!-- ===== EVALUATION MODAL ===== -->
    <div id="evaluationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-robot"></i> JokeBot says...</h2>
                <button class="modal-close" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">

                <!-- Robot Avatar with fallback -->
                <div class="robot-container">
                    <img src="data:image/jpeg;base64,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"
                        alt="Robot" class="robot-image"
                        onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="robot-icon-fallback"
                        style="display:none; width:100%; height:100%; background: var(--primary); border-radius:20px; align-items:center; justify-content:center; font-size:3rem;">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div id="robotMouth" class="robot-mouth"></div>
                </div>
                <!-- Evaluation Details -->
                <div id="modalResult" class="modal-result">
                    <!-- Will be filled by JS -->
                </div>
            </div>
            <div class="modal-footer">
                <button id="modalSpeakBtn" class="speak-btn">
                    <i class="fas fa-volume-up"></i> Speak Response
                </button>
            </div>
        </div>
    </div>

    <!-- ===== CHATBOT ===== -->
    <button class="chatbot-toggle" id="chatbotToggle">
        <i class="fas fa-comment"></i>
    </button>

    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div class="chatbot-title">
                <div class="chatbot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <h3>JokeAI Assistant</h3>
            </div>
            <div class="chatbot-actions">
                <button class="chatbot-btn" id="chatbotRefreshBtn" title="Clear chat">
                    <i class="fas fa-redo-alt"></i>
                </button>
                <button class="chatbot-btn" id="chatbotCloseBtn" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <!-- Quick Questions -->
        <div class="quick-questions" id="quickQuestions">
            <div class="quick-questions-title">Quick questions:</div>
            <div class="quick-questions-grid">
                <button class="quick-question-btn" data-question="How does scoring work?">üéØ Scoring</button>
                <button class="quick-question-btn" data-question="Who created this?">üë• Creators</button>
                <button class="quick-question-btn" data-question="Explain battery system">‚ö° Battery</button>
                <button class="quick-question-btn" data-question="Voice features">üé§ Voice</button>
            </div>
        </div>

        <!-- Messages -->
        <div class="chatbot-messages" id="chatbotMessages">
            <!-- Messages appear here -->
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <!-- Input Area -->
        <div class="chatbot-input-area">
            <input type="text" class="chatbot-input" id="chatbotInput"
                placeholder="Ask about jokes, scoring, or creators..." autocomplete="off" />
            <button class="chatbot-send" id="chatbotSend">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Voice Audio -->
    <audio id="aiVoice" hidden></audio>

    <!-- JavaScript -->
    <script src="script.js"></script>

    <script>
        // ===== CLEAN CHATBOT LOGIC =====

        const CHATBOT_KNOWLEDGE = {
            greetings: ["hi", "hello", "hey"],
            farewells: ["bye", "goodbye"],
            creators: [
                {
                    keywords: ["make u", "creators","creator", "who made", "who created", "build it", "build u", "developer"],
                    response: "This project was created by:\n\n" +
                        "Ali ‚Äî AI/ML Engineer\n" +
                        "‚Ä¢ Built the joke evaluation model\n" +
                        "‚Ä¢ Designed the scoring & battery logic\n\n" +
                        "Neha ‚Äî Frontend Developer\n" +
                        "‚Ä¢ Designed the UI & chatbot experience\n" +
                        "‚Ä¢ Made everything interactive and fun\n\n" +
                        "Ask me about jokes, scoring, battery, or voice features üòä"
                },
                {
                    keywords: ["neha", "ali", "neha and ali"],
                    response: "Yes! Ali and Neha are the creators.\n\nAli: AI/ML Engineer - Built the joke evaluation model\nNeha: Frontend Developer - Designed the user interface\n\nGreat teamwork for a fun project!"
                }
            ],
            jokes: [
                {
                    keywords: ["how", "work", "does work"],
                    response: "How JokeBot works:\n\n1. You tell me a joke\n2. I analyze it using AI\n3. I give you a score and feedback\n4. Battery charges/drains based on score\n\nSimple and fun!"
                },
                {
                    keywords: ["score", "scoring", "rate"],
                    response: "Scoring system:\n\n‚Ä¢ 90-100%: LEGENDARY\n‚Ä¢ 80-89%: EXCELLENT\n‚Ä¢ 70-79%: GREAT\n‚Ä¢ 60-69%: GOOD\n‚Ä¢ 50-59%: AVERAGE\n‚Ä¢ Below 50%: Needs work\n\nEach joke gets a detailed score."
                },
                {
                    keywords: ["battery", "energy"],
                    response: "Battery system:\n\nGood jokes: +(10-20)%\nAverage jokes: No change\nBad jokes: -(10-20)%\n\nKeep telling funny jokes to charge up!"
                },
                {
                    keywords: ["example", "examples"],
                    response: "Example jokes:\n\n1. Why don't scientists trust atoms? Because they make up everything!\n2. What do you call a fake noodle? An impasta!\n3. Why did the scarecrow win an award? He was outstanding in his field!"
                },
                {
                    keywords: ["voice", "speak", "audio"],
                    response: "Voice features:\n\n‚Ä¢ Record jokes by speaking\n‚Ä¢ AI speaks feedback aloud\n‚Ä¢ Works in modern browsers\n‚Ä¢ No extra setup needed"
                }
            ],
            ai: [
                {
                    keywords: ["ai", "artificial intelligence"],
                    response: "AI Technology:\n\n‚Ä¢ Uses RoBERTa model\n‚Ä¢ Trained on 60,000+ jokes\n‚Ä¢ Real-time evaluation\n‚Ä¢ 70 percent accuracy\n‚Ä¢ It created with 24,451,842 parameters \n‚Ä¢ Runs locally"
                },
                {
                    keywords: ["model", "roberta"],
                    response: "Model details:\n\n‚Ä¢ Fine-tuned transformer\n‚Ä¢ Processes jokes instantly\n‚Ä¢ Provides accurate scores\n‚Ä¢ Self-contained system"
                }
            ],
            help: [
                {
                    keywords: ["help", "support", "trouble"],
                    response: "Help topics:\n\n‚Ä¢ How to evaluate jokes\n‚Ä¢ Understanding scores\n‚Ä¢ Battery management\n‚Ä¢ Voice features\n‚Ä¢ General questions\n\nWhat do you need help with?"
                },
                {
                    keywords: ["reset", "restart", "clear"],
                    response: "Reset options:\n\n‚Ä¢ Battery reset: Click reset button\n‚Ä¢ Chat reset: Click refresh button in chat\n‚Ä¢ Full reset: Refresh the page\n\nEach reset has its own purpose."
                }
            ]
        };

        // DOM Elements
        const chatbotToggle = document.getElementById('chatbotToggle');
        const chatbotContainer = document.getElementById('chatbotContainer');
        const chatbotMessages = document.getElementById('chatbotMessages');
        const chatbotInput = document.getElementById('chatbotInput');
        const chatbotSend = document.getElementById('chatbotSend');
        const chatbotCloseBtn = document.getElementById('chatbotCloseBtn');
        const chatbotRefreshBtn = document.getElementById('chatbotRefreshBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const quickQuestionBtns = document.querySelectorAll('.quick-question-btn');

        // ===== HELPER: RANDOM GREETING =====
        function randomGreeting() {
            const greetings = [
                "Hey! üëã Nice to see you!",
                "Hello there üòÑ Ready for some jokes?",
                "Hi! ü§ñ I'm listening!",
                "Hey! Got a joke for me?"
            ];
            return greetings[Math.floor(Math.random() * greetings.length)];
        }

        // ===== INITIALIZE CHATBOT =====
        function initChatbot() {
            chatbotToggle.addEventListener('click', openChatbot);
            chatbotCloseBtn.addEventListener('click', closeChatbot);
            chatbotRefreshBtn.addEventListener('click', clearChat);
            chatbotSend.addEventListener('click', sendMessage);

            chatbotInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            quickQuestionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const question = btn.getAttribute('data-question');
                    chatbotInput.value = question;
                    sendMessage();
                });
            });

            // Add initial welcome
            setTimeout(() => {
                addMessage('bot', randomGreeting() + "\n\n" +
                    "This project was created by Ali and Neha. Ask me about jokes, scoring, battery, or voice features üòä"
                );
            }, 1000);
        }

        // ===== OPEN / CLOSE =====
        function openChatbot() {
            chatbotContainer.classList.add('active');
            chatbotToggle.style.display = 'none';
            chatbotInput.focus();
        }

        function closeChatbot() {
            chatbotContainer.classList.remove('active');
            chatbotToggle.style.display = 'flex';
        }

        // ===== CLEAR CHAT =====
        function clearChat() {
            chatbotMessages.innerHTML = '';
            addMessage('bot', "Chat cleared. Ask me anything! üí¨");
        }

        // ===== ADD MESSAGE =====
        function addMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chatbot-message ${sender}-message`;
            messageDiv.textContent = text;
            chatbotMessages.appendChild(messageDiv);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
            return messageDiv;
        }

        // ===== TYPING INDICATOR =====
        function showTyping() {
            typingIndicator.style.display = 'block';
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        // ===== TYPE EFFECT =====
        async function typeEffect(element, text) {
            element.textContent = '';
            for (let i = 0; i < text.length; i++) {
                element.textContent += text[i];
                chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
                const pause = ['.', '!', '?', '\n'].includes(text[i]) ? 50 : 20;
                await new Promise(resolve => setTimeout(resolve, pause));
            }
        }

        // ===== PROCESS MESSAGE =====
        function processMessage(input) {
            const msg = input.toLowerCase().trim();

            // Greetings
            if (CHATBOT_KNOWLEDGE.greetings.some(g => msg === g || msg.startsWith(g))) {
                return randomGreeting() + "\n\n" +
                    "This project was created by Ali and Neha. Ask me about jokes, scoring, battery, or voice features üòä";
            }

            // Farewells
            if (CHATBOT_KNOWLEDGE.farewells.some(f => msg.includes(f))) {
                return "Goodbye! üòä Keep telling funny jokes!";
            }

            // Small talk
            if (msg.includes("how are you")) {
                return "I'm doing great! üòÑ Fully charged and ready to hear some jokes! of any type";
            }
            if (msg.includes("what can you do")) {
                return "I can do quite a few things ü§ñ‚ú®\n" +
                    "‚Ä¢ Evaluate jokes with AI\n‚Ä¢ Give funny feedback & scores\n‚Ä¢ Manage the joke battery üîã\n‚Ä¢ Listen & speak using voice üé§\n‚Ä¢ Tell you about the creators\n\nTry asking me something!";
            }
            if (msg.includes("thank")) {
                return "You're welcome! üòÑ Keep the jokes coming!";
            }

            // Creators
            for (const item of CHATBOT_KNOWLEDGE.creators) {
                if (item.keywords.some(k => msg.includes(k))) {
                    return item.response;
                }
            }

            // Jokes
            for (const item of CHATBOT_KNOWLEDGE.jokes) {
                if (item.keywords.some(k => msg.includes(k))) {
                    return item.response;
                }
            }

            // AI
            for (const item of CHATBOT_KNOWLEDGE.ai) {
                if (item.keywords.some(k => msg.includes(k))) {
                    return item.response;
                }
            }

            // Help
            for (const item of CHATBOT_KNOWLEDGE.help) {
                if (item.keywords.some(k => msg.includes(k))) {
                    return item.response;
                }
            }

            // Battery status
            if (msg.includes('battery') && (msg.includes('how') || msg.includes('what') || msg.includes('current'))) {
                const percent = document.getElementById('batteryPercent').textContent;
                const status = document.getElementById('batteryStatus').textContent;
                return `Current battery: ${percent}\nStatus: ${status}\n\nGood jokes charge it, bad jokes drain it!`;
            }

            // Default fallback
            return "Hmm ü§î I'm not sure about that.\n\nYou can ask me about:\n" +
                "‚Ä¢ Joke scoring üéØ\n‚Ä¢ Battery system üîã\n‚Ä¢ Voice features üé§\n‚Ä¢ Creators üë•\n\nOr just say hi! üëã";
        }

        // ===== SEND MESSAGE =====
        async function sendMessage() {
            const input = chatbotInput.value.trim();
            if (!input) return;

            addMessage('user', input);
            chatbotInput.value = '';
            chatbotSend.disabled = true;
            chatbotInput.disabled = true;

            showTyping();
            await new Promise(resolve => setTimeout(resolve, 800));

            const response = processMessage(input);

            hideTyping();
            const botMessage = addMessage('bot', '');
            await typeEffect(botMessage, response);

            chatbotSend.disabled = false;
            chatbotInput.disabled = false;
            chatbotInput.focus();
        }

        // ===== INITIALIZE =====
        document.addEventListener('DOMContentLoaded', initChatbot);

        // Export for external control
        window.JokeAIChatbot = { open: openChatbot, close: closeChatbot, clear: clearChat };
    </script>


</body>

</html>